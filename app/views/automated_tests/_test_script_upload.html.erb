<div class="test_script">

<%= form.fields_for :test_scripts, test_script do |f| %>
<% saved = !f.object.new_record? %>
<% hide = saved ? 'style="display:none;"' : '' %>

<div class="dragarrows">â†•</div>

<fieldset class="settings_box">

  <legend>
    <span class='file_name'>
      <% if saved %>
        <%= f.object.script_name %>
      <% else %>
        <%= t('automated_tests.new_test_script_file') %>
      <% end %>
    </span>
    <%= link_to_function (saved ? '[+]' : '[-]'), "toggleSettings(this);", :class => "collapse" %>
  </legend>

  <%= f.hidden_field :seq_num, :value => f.object.seq_num, :class => "seqnum" %>

  <div class="settings_left_side">
    <div class="desc">
      <%= f.label :description, t('automated_tests.script_option.description'), :style => 'vertical-align:top;' %>
      <%= f.text_area :description, :value => f.object.description, :cols => 30, :rows => (saved ? 1 : 2)  %>
    </div>

    <%# For new test scripts, the settings box will be expanded and the settings box
        will be below the description textarea. For existing test scripts, their max
        marks field will be in the right side %>
    <% maxmarks_section  = '<div class="maxmarks">'
       maxmarks_section += f.label :max_marks, raw(t 'automated_tests.script_option.max_marks')
       maxmarks_section += "\n"
       maxmarks_section += f.text_field :max_marks, :value => f.object.max_marks, :size => 10, :maxlength => 8
       maxmarks_section += '</div>' %>
    <% if !saved %>
      <%= raw maxmarks_section %>
    <% end %>

  <div class="settings_right_side">
    <% if saved %>
      <%= raw maxmarks_section %>
    <% end %>

    <div <%= raw hide %>>
      <%= f.label :script_name, (saved ? t('automated_tests.replace') : t('automated_tests.upload_required').html_safe) %>
      <%= f.file_field :script_name, :size=>"30", :class => 'upload_file' %><br/>

      <%= f.label :run_on_request, t("automated_tests.script_option.run_on_request") %>
      <%= f.check_box :run_on_request, :value => f.object.run_on_request %><br/>
    
      <%= f.label :run_on_submission, t("automated_tests.script_option.run_on_submission") %>
      <%= f.check_box :run_on_submission, :value => f.object.run_on_submission %><br/>

      <%= f.label :halts_testing, t("automated_tests.script_option.halts_testing") %>
      <%= f.check_box :halts_testing, :value => f.object.halts_testing %>

      <br/>
      <% if saved %>
        <span class="label">
          <%= link_to(t(:download),
                      :action => 'download', 
                      :assignment_id => @assignment.id,
                      :type => 'script',
                      :filename => f.object.script_name) %>
        </span>
        <br/>

        <%= f.label :_destroy, t('automated_tests.remove_file') %>
        <%= f.check_box :_destroy, :class => "remove_test_script_file" %>
      <% else %>
        <%= label_tag "remove", link_to_function(t('automated_tests.remove_file'), "removeNewTestScript(this);") %>
      <% end %>
    </div>
  </div>
  <div style="clear:both;"></div>
</fieldset>

<% end %>
</div>
