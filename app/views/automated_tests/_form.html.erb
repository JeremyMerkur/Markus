<%= render :partial => 'boot.js' %>

<div class="wrapLeft">
<% if flash[:success] %>
<div class="success">
  <span><%=flash[:success]%></span>
</div>
<% elsif flash[:error] %>
<div class="error">
  <span><%=flash[:error]%></span>
</div>
<% end %>


<%= form_for @assignment,
       :as => :assignment,
       :url => manage_assignment_automated_tests_path(),
       :html => {:multipart => true} do |f| %>
<%= f.error_messages%>

  <p id="testing_framework_style">
    <%= f.check_box :enable_test, :id => "is_testing_framework_enabled", :onchange => "toggle_automated_tests(jQuery('#is_testing_framework_enabled').is(':checked'))" %>
    <%= label_tag "is_testing_framework_enabled", I18n.t("automated_tests.enable_test"), :class => "checkbox_label" %>
  </p>

  <div id="testing_framework_tokens">
    <p id="tokens">
      <%= label_tag :tokens_per_day, I18n.t("automated_tests.token.tokens_form"), :class => "inline_label" %>
      <%= f.text_field :tokens_per_day, :id=>"tokens_per_day", :size => 5, :maxlength => 3 %>
      <%= label_tag :unlimited_tokens, I18n.t("automated_tests.token.unlimited"), :class => "checkbox_label" %>
      <%= f.check_box :unlimited_tokens, :id => "unlimited_tokens", :onchange => "toggle_tests_tokens(jQuery('#unlimited_tokens').is(':checked'))" %>
    </p>
  </div>

<%= f.submit t(:submit) , :disable_with => I18n.t('working')%>
<% end %> 

  <fieldset>
    <legend><%= t("automated_tests.assignment_test_script_files") %></legend>
      <p>
        <%= button_to_function t('marker.marks.expand_all'), "change_all('expand');" %>
        <%= button_to_function t('marker.marks.collapse_all'), "change_all('collapse');" %>
      </p>
      <p><%= raw t("assignment.required_fields") %></p>

      <div id="test_scripts">
        <% @assignment.test_scripts.sort_by(&:seq_num).each do |ts| %>
          <%= render :partial => 'test_script_upload', :locals => {:test_script => ts, :is_new => 'false'} %>
        <% end %>
      </div>
      <p id="test_script_add_link">
        <%= link_to(t("automated_tests.add_test_script_file_link"), add_new_test_form_assignment_automated_tests_path, :remote => true, :id => "add_new_test_script_form") %>
      </p>
  </fieldset>

  <fieldset>
    <legend><%= t("automated_tests.assignment_test_support_files") %></legend>
    <div class="wrapLeft">
      <div id="test_support_files">
	    <% @assignment.test_support_files.sort_by(&:id).each do |tsf| %>
	      <%= render :partial => 'test_support_file_upload', :locals => {:test_support_file => tsf, :assignment => @assignment, :is_new => 'false' } %>
	    <% end %>
      </div>
      <p id="test_support_file_add_link">
        <%= link_to(t("automated_tests.add_test_support_file_link"),
         add_new_test_support_form_assignment_automated_tests_path, :remote => true, :id => "add_new_test_support_form") %>
      </p>
    </div>
  </fieldset>


</div>
